<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>A GPT-powered tutor | The Essence of Software</title>
<meta name="keywords" content="">
<meta name="description" content="Notes on designing a GPT-powered tutor using concepts">
<meta name="author" content="Daniel Jackson">
<link rel="canonical" href="https://essenceofsoftware.com/studies/larger/tutor/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.10b46262efde62bfde2e6b990234776439b6b9ca49ab4575de4ef7087668077b.css" integrity="sha256-ELRiYu/eYr/eLmuZAjR3ZDm2ucpJq0V13k73CHZoB3s=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://essenceofsoftware.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://essenceofsoftware.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://essenceofsoftware.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://essenceofsoftware.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://essenceofsoftware.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WRQ6HWW3ZW"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-WRQ6HWW3ZW', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="A GPT-powered tutor" />
<meta property="og:description" content="Notes on designing a GPT-powered tutor using concepts" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://essenceofsoftware.com/studies/larger/tutor/" /><meta property="og:image" content="https://essenceofsoftware.com/eos-twitter-card.png"/><meta property="article:section" content="studies" />
<meta property="article:published_time" content="2023-07-11T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-07-11T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://essenceofsoftware.com/eos-twitter-card.png"/>

<meta name="twitter:title" content="A GPT-powered tutor"/>
<meta name="twitter:description" content="Notes on designing a GPT-powered tutor using concepts"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Case Studies",
      "item": "https://essenceofsoftware.com/studies/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Longer case studies",
      "item": "https://essenceofsoftware.com/studies/larger/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "A GPT-powered tutor",
      "item": "https://essenceofsoftware.com/studies/larger/tutor/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "A GPT-powered tutor",
  "name": "A GPT-powered tutor",
  "description": "Notes on designing a GPT-powered tutor using concepts",
  "keywords": [
    
  ],
  "articleBody": "Overview About this case study. This case study presents a concept design for a GPT-powered tutor that we built in May 2023 for experimental use in the MIT class 6.1040: Software Studio this coming fall. Geoffrey Litt had the idea for the tutor and implemented it; the concept design was a joint effort. In this video Geoffrey demonstrates the tutor in action.\nPrimary motivations. From a concept design perspective, the case study offered an opportunity to:\nApply concept design in the earliest stages of development of an app; Provide an example of concept design for a real but small problem; Illustrate how concepts can help you address the kinds of design challenges that arise even in simple apps. Modular implementation. Geoffrey used this case study also as a chance to explore the use of concepts as a modularity mechanism in the code. He implemented the tutor in his Riffle framework, and used the concept design to guide the structure of the relational tables and code, so that each Riffle component corresponds to a concept. The results seem to be promising, bringing more clarity and modularity than a traditional design might have produced. I hope that Geoffrey will write something about this at some point.\nDesign Goals and Principles Goals. The goals of building and deploying the tutor are:\nTo get some initial experience using GPT-like tools in education; To help students learn concept design; To gather data both about students’ learning of concept design and about the performance of the AI tutor; To refine the pedagogy around concept design. Pedagogical alignment. Exploiting LLMs in teaching depends not surprisingly on providing good prompts. One of the most exciting aspects of this project has been the realization that the kinds of prompt GPT seems to need correspond closely to (my perceived sense of) what students need, namely short and explicit tutorials that offer actionable advice and concrete examples, both positive and negative. Due to the limitations of window size, we are also encouraged to make our tutorials as granular as possible, so that the prompts for a particular task can be limited to only the advice that is essential for that task. A further pedagogical alignment arises in the need to explicitly identify competences, linking the tasks students are asked to fulfill to the understanding those tasks require (and thus to the advice that will help them develop such understanding).\nDesign principles. In embarking on this project, we adopted a few principles to guide it:\nTo make the Simplest Thing That Works (STTW), as agilistas would say: that is, focusing on the smallest set of concepts and behaviors that would meet the goal of supporting students effectively; While serving the needs of concept design, to make the tutor as general as possible, avoiding any needless specialization, so that it might be applied in other domains; To reduce barrier to usage by students, which suggested not requiring accounts (and keeping interactions anonymous), implementing as a cross-platform web app (without browser extensions), and not being prescriptive about the order in which students attempt exercises; Making maintenance and deployment easy for course staff, and ensuring that adding new questions and advice was straightforward, which suggested making a serverless app (the implementation requiring only a tiny lambda function to proxy API requests to GPT) and not implementing a web-based UI for staff, but instead taking questions and advice from a table-structured file that is easily edited. Choice of tech stack. Initially, one of our principles was to implement the tutor using the tech stack taught in the class (Node/Express/Vue) so that the implementation might serve as a pedagogical example for students, but we decided in the end to use Riffle instead, both to “eat our own dog food”, exercising our research on that platform, and taking advantage of Riffle’s benefits, both in ease of development and to the user (most notably the full history of the user’s interactions being persisted locally in a SQL database inside the browser, giving the appearance of a backend storage without the need to implement it or compromise the user’s privacy).\nInitial design Basic conception. We started with the simple idea that the student would be presented with a collection of structured exercises. Attempted solutions to the exercises would be graded by GPT, providing feedback to the student, and allowing repeated submissions until the student was able to submit a solution for which GPT reported no evident flaws.\nPrompt contents. We assumed that we would not fine-tune the LLM, but would use GPT out of the box with appropriate prompts. We planned to include in the GPT prompt for a particular exercise the following elements:\nThe text of the exercise itself; A general prompt instructing GPT to behave as a tutor and to provide constructive advice without revealing the answer to the student, and to return its response as a JSON structure with a simple numeric grade (corresponding to poor, ok and good) and feedback text; One or more tutorials relevant to the competence being tested; A few sample graded solutions to the particular exercise (containing both grades and feedback). First concepts. Our initial brainstorm identified the following concepts:\nExercise: a concept defining the structure of exercises and the pattern of behavior of a student in submitting solutions. Advice: a collection of pieces of advice, each being a text string, perhaps indexed in competencies. We anticipated using this advice both as prompts for the LLM and as part of a help facility for students. Bot: we assumed we’d need a concept to represent the pattern of interactions with the GPT service. The need for such a concept became less clear as the design progressed, since GPT’s API (unlike its browser interface) is not stateful, and treats each query independently, so that the behavior is little more than a series of queries that produce responses. Editor: initially, I assumed we’d want a concept to embody the text editor that the student uses to edit and submit candidate solutions to exercises. Here’s a screenshot of the running app, showing the exercises on the left (with the selected exercise part highlighted); the submission and feedback boxes the middle; and the advice and chat panels on the right (explained in more detail below):\nDesign Challenges We pursued the design of these concepts in the light of several key challenges that we identified.\nSaving student solutions. We intended to include a simple way for students solutions to be saved, both so that students themselves could review their work and so that we could evaluate which exercises were the most useful, what students were able or not able to do, and so on.\nInitially, we thought to include this functionality in the Exercise concept. This would result in a nice operational principle (OP) for the concept, with the student selecting an exercise and submitting a series of solutions. If this functionality were instead factored out into another concept, the Exercise concept would be little more than a data structure containing the exercises, and would lack a compelling OP.\nOn the other hand, we realized that the submitted solutions would need to be indexed on the identities of students. In concept design terms, this means that the state of the Exercise concept would include relations like\nsubmitted: Student -\u003e Solution And yet there is no interaction between students; each student’s behavior and subsequent submitted solutions are independent. This suggests what I call lifting the concept, and defining the application using an indexed collection of concepts rather than indexing within the concept state itself. So the application might be declared like this\ninclude User UserExercise: User.User -\u003e one Exercise so that it includes a User concept (which exports a type User.User corresponding to the set of users), and an indexed collection UserExercise of concepts, with UserExercise[u] being the exercise concept for user u.\nThis is bad because it inappropriately replicates not only the student-specific submission behavior but also the exercises themselves, which should be defined independently of any students.\nThis dilemma is easily resolved by factoring out the part of the concept that is indeed student specific. So we created a new concept, which we called Drill, to represent the student behavior; this concept can now be indexed, and the Exercise concept can remain a single, student-independent concept instance. As we’ll see when we elaborate Drill, the concept will also include the current state of the student’s attempted solutions, obviating the need for an Editor concept.\nWe have yet to implement solution submission, and the app runs independently within each student’s browser. So we might have maintained a single Exercise concept that is student-independent because there is only one student in scope (namely the one using this browser). But the separation into Exercise and Drill is straightforward and brings some clarity without much overhead, and it ensures that our app is ready for this likely extension.\nThe one downside of this approach is that the Exercise concept no longer has a compelling OP; all the interaction happens in Drill. This seemed a reasonable price to pay, and made me realize that I should acknowledge a class of “CRUD concepts” that are essentially just containers for data. I’ve been resisting this idea but it seems that most applications are likely to have one or more of such concepts.\nLinking advice to exercises. How should advice be linked to exercises? Our initial idea was to include, in the Exercise concept, a mapping from parts of exercises to the “competences” that they tested, and to index advice texts in the Advice concept on “topics” that would be equated to competences. The two concepts would be polymorphic in these types, with an additional Competence concept providing concrete competences to instantiate the two other concepts:\ninclude Competence Advice Exercise Note that I’ve overloaded Competence here so it refers to both the concept and the type of value it exports (as I did for User.User above).\nThis approach makes sense, but there wasn’t much functionality we wanted to associate with competences aside from the linking of exercises to advise. So we decided to simple have the Exercise concept define (and export) the competences. This gives the following structure\ninclude Exercise CompetenceAdvice: Advice ExerciseAdvice: Advice in which Advice is instantiated with the Competence type provided by Exercise. Note that I’ve instantiated Advice twice: once for the advice associated with competences, and a second time for the advice associated with individual parts of exercises.\nMaintaining editor state. Our sketched UI included a text box in which the student enters attempted solutions. We wanted to persist the content of this box across submissions, so that when a student gets feedback and wants to adjust their last submission to create the new one, they don’t need to cut and paste the prior submission in (or, worse, have to retype it). We also thought it would be good to allow a student to switch between unfinished exercises, so that when you return to an exercise you can continue editing the solution.\nThis functionality was easily accomplished within the Drill concept, with state components for (a) the task that is selected; (b) the current text associated with each task; and (c) the submitted text for each task.\nconcept Drill state selected: lone Task current: Task -\u003e lone Text submitted: Task -\u003e lone Text Since the Drill concept should work with text being submitted for any kind of task, a type variable Task is used to represent what will be, when instantiated, the exercises (or actually their parts).\nThese state components are updated by actions in the obvious way: editing the text in the text box corresponds to an edit action that replaces the currentText associated with the selected task; submitting a solution corresponds to a submit action that copies the current text of the selected task to the submitted text of that task.\nBy virtue of this state and actions, this concept eliminates the need for a separate Editor concept.\nIntegrating chat. We implemented the design as described above, and also included a help panel with two tabs. One shows advice associated with the current exercise part, produced by a query that looks in the state of the Advice concept for the advice associated with the selected task in the Drill concept. The other offers a chat interaction with GPT, where the user can ask follow-up questions.\nTwo questions arose for the chat interaction. First, what would be the context for the chat? It seemed clear that there should be a separate chat thread for each exercise part, switched using the same action that switches the (solution editing) text box. The prompts for this chat would then be (a) the same advice provided for the grading, along with (b) prior submissions, and (c) earlier questions asked by the student in that thread.\nIt wasn’t obvious at first how to integrate the prior submissions and grading feedback into the chat thread. One possibility was for the chat per se to show only chat questions asked by the student and the responses to them, with the submitted solutions and their feedback shown in a different way–either in a thread in a separate panel, or shown inserted into the chat thread as special objects.\nA moment’s reflection made it clear that this kind of solution was baroque and needlessly complicated. It would either require yet another UI panel (and make it harder for the user to see which follow-up questions followed which submissions) or it would make the chat thread UI non-uniform. The solution is simply to fully embrace the familiar Chat concept, in which a thread comprises a sequence of messages from two (or more) parties. Then student submissions and feedback are then just injected as regular messages, from the student and bot respectively. It might also have been possible to treat these messages as originating with two additional users, distinguishing the two roles of the student (as submitter of solutions and asker of follow-up questions) and the two roles of the bot (as grader and question-answerer). Rather than doing this, we chose to stick to two parties in the chat and to prefix the submissions and feedback with “You submitted: …” and “Feedback: …”.\nHere’s a screenshot showing the chat panel:\nFinal Concept Design We now outline the concepts in detail. The Exercise concept manages the exercise texts, and associates parts of exercises with competences:\nconcept Exercise purpose construct and present structured exercises principle // just a CRUD concept state parts: Exercise one -\u003e set Part competence: Part -\u003e one Competence description: Exercise + Part -\u003e one Text (Since the purpose of the concept is just to store exercises, it doesn’t have an interesting operational principle, so rather than elaborating the expected behavior of CRUD actions, I’ve just omitted them and left the principle empty too.)\nThe Advice concept indexes advice texts on generic topic identifiers (which will later be instantiated with competences and exercise parts):\nconcept Advice [Topic] purpose manage indexed repository of advice principle // just a CRUD concept state advices: Topic -\u003e set Text name: Topic lone -\u003e one Text The student activity of completing an exercise is handled by the Drill concept:\nconcept Drill purpose store incremental student work on set of tasks principle // if you select a task, edit a solution // and submit it, the final edit is recorded // as the submission selectTask (t); edit (x1); edit (x2); submit (); {t.submitted = x2} state selected: lone Task current: Task -\u003e lone Text submitted: Task -\u003e lone Text actions selectTask (t: Task) selected := t edit (x: Text) selected.current := x submit () selected.submitted := selected.current The Task type is left generic, but will be instantiated later as the Part type of the Exercise concept.\nThe Chat concept will manage the informal exchanges between user and bot, and will have the exercise submissions and their grading injected as additional messages:\nconcept Chat purpose multi-party exchange of messages principle // series of posts gives expected msg sequence post (p1, t1, m1); post (p2, t2, m2); {msgs = , m_i.author = p_i, m_i.content = t_i, etc} state msgs: seq Msg author: Msg -\u003e one Party content: Msg -\u003e one Text actions post (p: Party, t: Text, out m: Msg) Finally, the concept that captures the protocol of interacting with LLMs like GPT:\nconcept Bot purpose handle interaction with AI agent principle // a query is submitted and a response is given ask (q1, r1) {queries = and responses = } state queries, responses: seq Text actions ask (query: Text, out response: Text) This is almost the simplest form this concept might take, with the prompts included in the question text. A richer concept would allow prompts to be registered upfront. The API version of GPT is actually stateless, so even the question and answer sequences are not strictly necessary.\nConcept Composition The app as a whole is a composition of concepts:\napp ConceptTutor include User Exercise UserDrill: User.User -\u003e one Drill CompetenceAdvice: Advice ExerciseAdvice: Advice UserPartChat: User.User, Exercise.Part -\u003e one Chat Bot We haven’t specified the User concept, since it could take many forms; all that matters for tracking completed exercises is that it provide some identifiers, given by the type User.User, which indexes the Drill concept, so there is one instance of Drill for each user. In our implementation, the browser naturally provides a distinct identifier for each user and no explicit implementation of such a concept is needed. We currently aren’t recording completed exercises, but could easily do that by labeling them with a browser identifier, for example.\nThere are two instantiations of the Advice concept, one holding advice for each competence and one holding specific advice for each exercise part.\nThe Chat concept is instantiated in two dimensions, over users and exercise parts, so each user has a separate chat for each exercise part they are working on. The Party parameter of the Chat concept is instantiated with a type consisting of two simple constant values: USER representing the user, and BOT representing the LLM bot. Don’t be confused by the User vs. Party types: the users of the app as a whole are not the parties to the chats, since each chat involves only one user (and the bot).\nConcept Synchronizations Almost all of the actions of the concepts are executed independently but there are a few key synchronizations.\nOne occurs when the student submits a solution to an exercise part:\nsync userSubmitsPart (u: User)\twhen UserDrill[u].submit () let p = UserDrill[u].selectedTask c = Exercise.competence[p] q = ExerciseAdvice[p] ^ CompetenceAdvice[c] ^ Exercise.description[p] ^ UserDrill[u].current[p] in Bot.ask (q, r) UserPartChat[u,p].post (USER, q, qm) UserPartChat[u,p].post (BOT, r, rm) When a user clicks on the button to submit a solution, the relevant exercise part p is the one that is selected (in the Exercise concept), and it has an associated competence c. The advice texts for the exercise and competence are found in the Advice concept state, and concatenated with the exercise text and the student solution to form the query q to the LLM. The query and the LLM’s response r are then posted in the chat on behalf of the nominal USER party and BOT party.\nA technical note: For brevity, I’ve assumed that the out parameters of actions are declared implicitly. In a more conventional programming style, I might have written\nMsg rm = UserPartChat[u,p].post (BOT, r) for example. I prefer to treat the out parameters more like other arguments so they can be named (which matters more when an action has more than one of them). Also, I haven’t included the extra prefixes that are added to the chat posts (“You submitted: “, “Feedback: “).\nA similar but simpler sync is needed when the user posts a question to the LLM in the chat.\nThe design as a diagram The entire concept design can be shown as a diagram. Here it is:\nEach concept is shown as a box with a thick grey outline. Inside each box, there is the concept state (shown as a kind of entity relationship diagram), and arrows representing actions.\nLet’s look at the Drill concept, for example. There are two sets represented in the state by the capitalized words \u003cTask\u003e and Text. \u003cTask\u003e is a type parameter (hence the angle brackets); you can see from the dotted line that in the composition it is bound to the Part type of the Exercise concept. Text is a primitive type of text strings. The two relations between \u003cTask\u003e and Text are shown as solid lines, and correspond to the declarations in the textual form of the concept:\ncurrent: Task -\u003e lone Text submitted: Task -\u003e lone Text The “pin” labeled selected represents the selected task:\nselected: lone Task There are three solid arrows representing the three actions of the concept, and their target shows which state component they update. So selectTask sets which task is selected; edit updates the current text for a task; and submit sets the submitted text for a task.\nThe dashed arrows represent the synchronizations. So the arrow from submit to ask says that when submit happens there is a sync that causes ask to happen to; and the arrow from ask to post means that this third action will happen too.\nA few more details about the diagrammatic notation:\nRelations. I’m using lines to represent relations, as in entity-relationship diagrams. I realize that programmers who are unfamiliar with ER or UML diagrams find this confusing, but in my view it’s superior to any other way of showing an abstract state and there are no viable alternatives. No relation arrows. I’ve departed from traditional ER representations (and notation that I’ve advocated myself and taught to students in the past, such as the diagrammatic notation for Alloy) in a few key respects. There are no arrows on the relations, even though a mathematical relation is directed. I removed the arrows both because the direction is not essential to the design (it’s only needed to ensure that updates and queries are specified consistently), and more importantly, I want the design diagram to emphasize causality, so I’m reserving arrows for causal effects. Sets as pins. Another departure from ER is to show dynamic subsets as pins, rather than using a special subset arrow. I like this because it’s easier to draw and allows you to follow paths in the diagram (so selected.current, eg, is the path that gets you the current text of the selected task). Omissions. I’ve omitted some details that are present in the textual form that could be included, most notably relation multiplicities. I’ve also omitted some state components (such as the description relation for exercises), and am only showing some synchronizations. Instantiations. I’ve only shown one instantiation of Advice, and the indexing of Drill and Chat isn’t shown. I plan to write a tutorial soon explaining the notation in more detail.\nState Queries and Concept Mapping A simple action involving one concept can still result in a variety of effects in the user interface. Note in particular that when the action\nUserDrill[u].selectTask(p) is performed, in which a user u selects exercise part p as their current task, the editor buffer will be updated to display\nUserDrill[u].current[UserDrill[u].selected] which holds the current version of the text for the selected part, and the help window will display\nCompetenceAdvice.advices[ Exercise.competence[UserDrill[u].selected] ] which is the advice text for the competence associated with the current exercise part. These updates occur because the view in the user interface is defined in terms of queries over the concept states. You should think of these queries being executed reactively. Their definition is part of what I call the concept mapping and might be elaborated more or less explicitly along with the wireframe design.\nSummary of Concept Design Principles This case study has illustrated the following concept design principles:\nModularity. Because the app has only one page, and its various elements interact with each other, conventional approaches would treat the app as a monolith (eg, in a typical UX approach by specifying wireframes and flows, or in a more formal approach by creating a single data model). Using concepts, we were able to break the app into pieces that can be understood independently, and to describe the interactions as syncs. Familiarity. Concept design encourages you to use standard, familiar concepts when possible: we did this with the Chat concept, avoiding specializing it to incorporate submissions and feedback. Polymorphism. Concepts should be as generic as possible. Making Advice polymorphic in the Topic type, and not tying it to competences, allowed us to instantiate it also to hold advice about particular exercise parts. Lifting. Many concepts can be simplified by removing indexing from the concept’s local state and applying it at the app level, with an indexed collection of concept instances instead. We applied this to the Chat and Drill concepts. In the case of Drill, the opportunity to lift suggested factoring Drill out from Exercise, which also helpfully separates static data (the exercises and their components) from dynamic data (the evolving submissions). Abstraction. Details of a concept are excluded if they are not relevant to the essential design questions. For example, Drill.edit embodies all the complexity of a text editor, but for the purpose of high-level design, it’s best just to assume this. ",
  "wordCount" : "4223",
  "inLanguage": "en",
  "datePublished": "2023-07-11T00:00:00Z",
  "dateModified": "2023-07-11T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Daniel Jackson"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://essenceofsoftware.com/studies/larger/tutor/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "The Essence of Software",
    "logo": {
      "@type": "ImageObject",
      "url": "https://essenceofsoftware.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://essenceofsoftware.com" accesskey="h" title="The Essence of Software (Alt + H)">The Essence of Software</a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://essenceofsoftware.com/ask/" title="FAQ">
                    <span>FAQ</span>
                </a>
            </li>
            <li>
                <a href="https://essenceofsoftware.com/buy/" title="Buy">
                    <span>Buy</span>
                </a>
            </li>
            <li>
                <a href="https://essenceofsoftware.com/reviews/" title="Reviews">
                    <span>Reviews</span>
                </a>
            </li>
            <li>
                <a href="https://essenceofsoftware.com/author/" title="Author">
                    <span>Author</span>
                </a>
            </li>
            <li>
                <a href="https://essenceofsoftware.com/posts/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://essenceofsoftware.com/tutorials/" title="Tutorials">
                    <span>Tutorials</span>
                </a>
            </li>
            <li>
                <a href="https://essenceofsoftware.com/studies/" title="Case Studies">
                    <span>Case Studies</span>
                </a>
            </li>
            <li>
                <a href="https://essenceofsoftware.com/subscribe/" title="Subscribe">
                    <span>Subscribe</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      A GPT-powered tutor
    </h1>
    <div class="post-description">
      Notes on designing a GPT-powered tutor using concepts
    </div>
    <div class="post-meta"><span title='2023-07-11 00:00:00 +0000 UTC'>July 11, 2023</span>&nbsp;·&nbsp;20 min&nbsp;·&nbsp;Daniel Jackson&nbsp;|&nbsp;<a href="https://forum.essenceofsoftware.com" rel="noopener noreferrer" target="_blank">Comments</a>

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#overview" aria-label="Overview">Overview</a></li>
                <li>
                    <a href="#design-goals-and-principles" aria-label="Design Goals and Principles">Design Goals and Principles</a></li>
                <li>
                    <a href="#initial-design" aria-label="Initial design">Initial design</a></li>
                <li>
                    <a href="#design-challenges" aria-label="Design Challenges">Design Challenges</a></li>
                <li>
                    <a href="#final-concept-design" aria-label="Final Concept Design">Final Concept Design</a></li>
                <li>
                    <a href="#concept-composition" aria-label="Concept Composition">Concept Composition</a></li>
                <li>
                    <a href="#concept-synchronizations" aria-label="Concept Synchronizations">Concept Synchronizations</a></li>
                <li>
                    <a href="#the-design-as-a-diagram" aria-label="The design as a diagram">The design as a diagram</a></li>
                <li>
                    <a href="#state-queries-and-concept-mapping" aria-label="State Queries and Concept Mapping">State Queries and Concept Mapping</a></li>
                <li>
                    <a href="#summary-of-concept-design-principles" aria-label="Summary of Concept Design Principles">Summary of Concept Design Principles</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="overview">Overview<a hidden class="anchor" aria-hidden="true" href="#overview">#</a></h1>
<p><strong>About this case study</strong>. This case study presents a concept design for a GPT-powered tutor that we built in May 2023 for experimental use in the MIT class <a href="https://61040-fa23.github.io">6.1040: Software Studio</a> this coming fall. Geoffrey Litt had the idea for the tutor and implemented it; the concept design was a joint effort. In <a href="https://share.cleanshot.com/P0VybXyY">this video</a> Geoffrey demonstrates the tutor in action.</p>
<p><strong>Primary motivations</strong>. From a concept design perspective, the case study offered an opportunity to:</p>
<ul>
<li>Apply concept design in the earliest stages of development of an app;</li>
<li>Provide an example of concept design for a real but  small problem;</li>
<li>Illustrate how concepts can help you address the kinds of design challenges that arise even in simple apps.</li>
</ul>
<p><strong>Modular implementation</strong>. Geoffrey used this case study also as a chance to explore the use of concepts as a modularity mechanism in the code. He implemented the tutor in his <a href="riffle.systems">Riffle</a> framework, and used the concept design to guide the structure of the relational tables and code, so that each Riffle component corresponds to a concept. The results seem to be promising, bringing more clarity and modularity than a traditional design might have produced. I hope that Geoffrey will write something about this at some point.</p>
<h1 id="design-goals-and-principles">Design Goals and Principles<a hidden class="anchor" aria-hidden="true" href="#design-goals-and-principles">#</a></h1>
<p><strong>Goals</strong>. The goals of building and deploying the tutor are:</p>
<ul>
<li>To get some initial experience using GPT-like tools in education;</li>
<li>To help students learn concept design;</li>
<li>To gather data both about students’ learning of concept design and about the performance of the AI tutor;</li>
<li>To refine the pedagogy around concept design.</li>
</ul>
<p><strong>Pedagogical alignment</strong>. Exploiting LLMs in teaching depends not surprisingly on providing good prompts. One of the most exciting aspects of this project has been the realization that the kinds of prompt GPT seems to need correspond closely to (my perceived sense of) what students need, namely short and explicit tutorials that offer actionable advice and concrete examples, both positive and negative. Due to the limitations of window size, we are also encouraged to make our tutorials as granular as possible, so that the prompts for a particular task can be limited to only the advice that is essential for that task. A further pedagogical alignment arises in the need to explicitly identify competences, linking the tasks students are asked to fulfill to the understanding those tasks require (and thus to the advice that will help them develop such understanding).</p>
<p><strong>Design principles</strong>. In embarking on this project, we adopted a few principles to guide it:</p>
<ul>
<li>To make the Simplest Thing That Works (STTW), as agilistas would say: that is, focusing on the smallest set of concepts and behaviors that would meet the goal of supporting students effectively;</li>
<li>While serving the needs of concept design, to make the tutor as general as possible, avoiding any needless specialization, so that it might be applied in other domains;</li>
<li>To reduce barrier to usage by students, which suggested not requiring accounts (and keeping interactions anonymous), implementing as a cross-platform web app (without browser extensions), and not being prescriptive about the order in which students attempt exercises;</li>
<li>Making maintenance and deployment easy for course staff, and ensuring that adding new questions and advice was straightforward, which suggested making a serverless app (the implementation requiring only a tiny lambda function to proxy API requests to GPT) and not implementing a web-based UI for staff, but instead taking questions and advice from a table-structured file that is easily edited.</li>
</ul>
<p><strong>Choice of tech stack</strong>. Initially, one of our principles was to implement the tutor using the tech stack taught in the class (Node/Express/Vue) so that the implementation might serve as a pedagogical example for students, but we decided in the end to use <a href="riffle.systems">Riffle</a> instead, both to &ldquo;eat our own dog food&rdquo;, exercising our research on that platform, and taking advantage of Riffle’s benefits, both in ease of development and to the user (most notably the full history of the user&rsquo;s interactions being persisted locally in a SQL database inside the browser, giving the appearance of a backend storage without the need to implement it or compromise the user&rsquo;s privacy).</p>
<h1 id="initial-design">Initial design<a hidden class="anchor" aria-hidden="true" href="#initial-design">#</a></h1>
<p><strong>Basic conception</strong>. We started with the simple idea that the student would be presented with a collection of structured exercises. Attempted solutions to the exercises would be graded by GPT, providing feedback to the student, and allowing repeated submissions until the student was able to submit a solution for which GPT reported no evident flaws.</p>
<p><strong>Prompt contents</strong>. We assumed that we would not fine-tune the LLM, but would use GPT out of the box with appropriate prompts. We planned to include in the GPT prompt for a particular exercise the following elements:</p>
<ul>
<li>The text of the exercise itself;</li>
<li>A general prompt instructing GPT to behave as a tutor and to provide constructive advice without revealing the answer to the student, and to return its response as a JSON structure with a simple numeric grade (corresponding to poor, ok and good) and feedback text;</li>
<li>One or more tutorials relevant to the competence being tested;</li>
<li>A few sample graded solutions to the particular exercise (containing both grades and feedback).</li>
</ul>
<p><strong>First concepts</strong>. Our initial brainstorm identified the following concepts:</p>
<ul>
<li><strong>Exercise</strong>: a concept defining the structure of exercises and the pattern of behavior of a student in submitting solutions.</li>
<li><strong>Advice</strong>: a collection of pieces of advice, each being a text string, perhaps indexed in competencies. We anticipated using this advice both as prompts for the LLM and as part of a help facility for students.</li>
<li><strong>Bot</strong>: we assumed we&rsquo;d need a concept to represent the pattern of interactions with the GPT service. The need for such a concept became less clear as the design progressed, since GPT&rsquo;s API (unlike its browser interface) is not stateful, and treats each query independently, so that the behavior is little more than a series of queries that produce responses.</li>
<li><strong>Editor</strong>: initially, I assumed we&rsquo;d want a concept to embody the text editor that the student uses to edit and submit candidate solutions to exercises.</li>
</ul>
<p>Here’s a screenshot of the running app, showing the exercises on the left (with the selected exercise part highlighted); the submission and feedback boxes the middle; and the advice and chat panels on the right (explained in more detail below):</p>
<p><img loading="lazy" src="screenshot-with-help.png" alt=""  />
</p>
<h1 id="design-challenges">Design Challenges<a hidden class="anchor" aria-hidden="true" href="#design-challenges">#</a></h1>
<p>We pursued the design of these concepts in the light of several key challenges that we identified.</p>
<p><strong>Saving student solutions</strong>. We intended to include a simple way for students solutions to be saved, both so that students themselves could review their work and so that we could evaluate which exercises were the most useful, what students were able or not able to do, and so on.</p>
<p>Initially, we thought to include this functionality in the <em>Exercise</em> concept. This would result in a nice operational principle (OP) for the concept, with the student selecting an exercise and submitting a series of solutions. If this functionality were instead factored out into another concept, the <em>Exercise</em> concept would be little more than a data structure containing the exercises, and would lack a compelling OP.</p>
<p>On the other hand, we realized that the submitted solutions would need to be indexed on the identities of students. In concept design terms, this means that the state of the <em>Exercise</em> concept would include relations like</p>
<pre><code>submitted: Student -&gt; Solution
</code></pre>
<p>And yet there is no interaction between students; each student&rsquo;s behavior and subsequent submitted solutions are independent. This suggests what I call <em>lifting</em> the concept, and defining the application using an indexed collection of concepts rather than indexing within the concept state itself. So the application might be declared like this</p>
<pre><code>include
	User
	UserExercise: User.User -&gt; one Exercise
</code></pre>
<p>so that it includes a <em>User</em> concept (which exports a type <em>User.User</em> corresponding to the set of users), and an indexed collection <em>UserExercise</em> of concepts, with <em>UserExercise[u]</em> being the exercise concept for user <em>u</em>.</p>
<p>This is bad because it inappropriately replicates not only the student-specific submission behavior but also the exercises themselves, which should be defined independently of any students.</p>
<p>This dilemma is easily resolved by factoring out the part of the concept that is indeed student specific. So we created a new concept, which we called <em>Drill</em>, to represent the student behavior; this concept can now be indexed, and the <em>Exercise</em> concept can remain a single, student-independent concept instance. As we&rsquo;ll see when we elaborate <em>Drill</em>, the concept will also include the current state of the student&rsquo;s attempted solutions, obviating the need for an <em>Editor</em> concept.</p>
<p>We have yet to implement solution submission, and the app runs independently within each student&rsquo;s browser. So we might have maintained a single <em>Exercise</em> concept that is student-independent because there is only one student in scope (namely the one using this browser). But the separation into <em>Exercise</em> and <em>Drill</em> is straightforward and brings some clarity without much overhead, and it ensures that our app is ready for this likely extension.</p>
<p>The one downside of this approach is that the <em>Exercise</em> concept no longer has a compelling OP; all the interaction happens in <em>Drill</em>. This seemed a reasonable price to pay, and made me realize that I should acknowledge a class of “CRUD concepts” that are essentially just containers for data. I’ve been resisting this idea but it seems that most applications are likely to have one or more of such concepts.</p>
<p><strong>Linking advice to exercises</strong>. How should advice be linked to exercises? Our initial idea was to include, in the <em>Exercise</em> concept, a mapping from parts of exercises to the “competences” that they tested, and to index advice texts in the <em>Advice</em> concept on “topics” that would be equated to competences. The two concepts would be polymorphic in these types, with an additional <em>Competence</em> concept providing concrete competences to instantiate the two other concepts:</p>
<pre><code>include
	Competence
	Advice &lt;Competence.Competence&gt;
	Exercise &lt;Competence.Competence&gt;
</code></pre>
<p>Note that I’ve overloaded <em>Competence</em> here so it refers to both the concept and the type of value it exports (as I did for <em>User.User</em> above).</p>
<p>This approach makes sense, but there wasn’t much functionality we wanted to associate with competences aside from the linking of exercises to advise. So we decided to simple have the <em>Exercise</em> concept define (and export) the competences. This gives the following structure</p>
<pre><code>include
	Exercise
	CompetenceAdvice: Advice &lt;Exercise.Competence&gt;
	ExerciseAdvice: Advice &lt;Exercise.Part&gt;
</code></pre>
<p>in which <em>Advice</em> is instantiated with the <em>Competence</em> type provided by <em>Exercise</em>. Note that I’ve instantiated <em>Advice</em> twice: once for the advice associated with competences, and a second time for the advice associated with individual parts of exercises.</p>
<p><strong>Maintaining editor state</strong>. Our sketched UI included a text box in which the student enters attempted solutions. We wanted to persist the content of this box across submissions, so that when a student gets feedback and wants to adjust their last submission to create the new one, they don’t need to cut and paste the prior submission in (or, worse, have to retype it). We also thought it would be good to allow a student to switch between unfinished exercises, so that when you return to an exercise you can continue editing the solution.</p>
<p>This functionality was easily accomplished within the <em>Drill</em> concept, with state components for (a) the task that is selected; (b) the current text associated with each task; and (c) the submitted text for each task.</p>
<pre><code>concept Drill &lt;Task&gt;
state
	selected: lone Task
	current: Task -&gt; lone Text
	submitted: Task -&gt; lone Text
</code></pre>
<p>Since the <em>Drill</em> concept should work with text being submitted for any kind of task, a type variable <em>Task</em> is used to represent what will be, when instantiated, the exercises (or actually their parts).</p>
<p>These state components are updated by actions in the obvious way: editing the text in the text box corresponds to an <em>edit</em> action that replaces the <em>currentText</em> associated with the <em>selected</em> task; submitting a solution corresponds to a <em>submit</em> action that copies the <em>current</em> text of the <em>selected</em> task to the <em>submitted</em> text of that task.</p>
<p>By virtue of this state and actions, this concept eliminates the need for a separate <em>Editor</em> concept.</p>
<p><strong>Integrating chat</strong>. We implemented the design as described above, and also included a help panel with two tabs. One shows advice associated with the current exercise part, produced by a query that looks in the state of the <em>Advice</em> concept for the advice associated with the selected task in the <em>Drill</em> concept. The other offers a chat interaction with GPT, where the user can ask follow-up questions.</p>
<p>Two questions arose for the chat interaction. First, what would be the context for the chat? It seemed clear that there should be a separate chat thread for each exercise part, switched using the same action that switches the (solution editing) text box. The prompts for this chat would then be (a) the same advice provided for the grading, along with (b) prior submissions, and (c) earlier questions asked by the student in that thread.</p>
<p>It wasn’t obvious at first how to integrate the prior submissions and grading feedback into the chat thread. One possibility was for the chat per se to show only chat questions asked by the student and the responses to them, with the submitted solutions and their feedback shown in a different way&ndash;either in a thread in a separate panel, or shown inserted into the chat thread as special objects.</p>
<p>A moment’s reflection made it clear that this kind of solution was baroque and needlessly complicated. It would either require yet another UI panel (and make it harder for the user to see which follow-up questions followed which submissions) or it would make the chat thread UI non-uniform. The solution is simply to fully embrace the familiar <em>Chat</em> concept, in which a thread comprises a sequence of messages from two (or more) parties. Then student submissions and feedback are then just injected as regular messages, from the student and bot respectively. It might also have been possible to treat these messages as originating with two additional users, distinguishing the two roles of the student (as submitter of solutions and asker of follow-up questions) and the two roles of the bot (as grader and question-answerer). Rather than doing this, we chose to stick to two parties in the chat and to prefix the submissions and feedback with “You submitted: &hellip;” and “Feedback: &hellip;”.</p>
<p>Here’s a screenshot showing the chat panel:</p>
<p><img loading="lazy" src="screenshot-with-chat.png" alt=""  />
</p>
<h1 id="final-concept-design">Final Concept Design<a hidden class="anchor" aria-hidden="true" href="#final-concept-design">#</a></h1>
<p>We now outline the concepts in detail. The <em>Exercise</em> concept manages the exercise texts, and associates parts of exercises with competences:</p>
<pre><code>concept Exercise
purpose construct and present structured exercises
principle // just a CRUD concept
state
  parts: Exercise one -&gt; set Part
  competence: Part -&gt; one Competence
  description: Exercise + Part -&gt; one Text
</code></pre>
<p>(Since the purpose of the concept is just to store exercises, it doesn’t have an interesting operational principle, so rather than elaborating the expected behavior of CRUD actions, I’ve just omitted them and left the principle empty too.)</p>
<p>The <em>Advice</em> concept indexes advice texts on generic topic identifiers (which will later be instantiated with competences and exercise parts):</p>
<pre><code>concept Advice [Topic]
purpose manage indexed repository of advice
principle // just a CRUD concept
state
  advices: Topic -&gt; set Text
  name: Topic lone -&gt; one Text
</code></pre>
<p>The student activity of completing an exercise is handled by the <em>Drill</em> concept:</p>
<pre><code>concept Drill &lt;Task&gt;
purpose
  store incremental student work on set of tasks
principle
  // if you select a task, edit a solution
  // and submit it, the final edit is recorded
  // as the submission
  selectTask (t); edit (x1); edit (x2); submit ();
  {t.submitted = x2}
state
  selected: lone Task
  current: Task -&gt; lone Text
  submitted: Task -&gt; lone Text
actions
  selectTask (t: Task)
    selected := t
  edit (x: Text)
    selected.current := x
  submit ()
    selected.submitted := selected.current
</code></pre>
<p>The <em>Task</em> type is left generic, but will be instantiated later as the <em>Part</em> type of the <em>Exercise</em> concept.</p>
<p>The <em>Chat</em> concept will manage the informal exchanges between user and bot, and will have the exercise submissions and their grading injected as additional messages:</p>
<pre><code>concept Chat &lt;Party&gt;
purpose multi-party exchange of messages
principle
	// series of posts gives expected msg sequence
	post (p1, t1, m1); post (p2, t2, m2);
	{msgs = &lt;m1, m2&gt;, m_i.author = p_i, m_i.content = t_i, etc}
state
  msgs: seq Msg
  author: Msg -&gt; one Party
  content: Msg -&gt; one Text
actions
  post (p: Party, t: Text, out m: Msg)
</code></pre>
<p>Finally, the concept that captures the protocol of interacting with LLMs like GPT:</p>
<pre><code>concept Bot
purpose handle interaction with AI agent
principle
  // a query is submitted and a response is given
  ask (q1, r1) {queries = &lt;q1&gt; and responses = &lt;r1&gt;}
state
  queries, responses: seq Text
actions
  ask (query: Text, out response: Text)
</code></pre>
<p>This is almost the simplest form this concept might take, with the prompts included in the question text. A richer concept would allow prompts to be registered upfront. The API version of GPT is actually stateless, so even the question and answer sequences are not strictly necessary.</p>
<h1 id="concept-composition">Concept Composition<a hidden class="anchor" aria-hidden="true" href="#concept-composition">#</a></h1>
<p>The app as a whole is a composition of concepts:</p>
<pre><code>app ConceptTutor
include
  User
  Exercise
  UserDrill: User.User -&gt; one Drill &lt;Exercise.Part&gt;
  CompetenceAdvice: Advice &lt;Exercise.Competence&gt;
  ExerciseAdvice: Advice &lt;Exercise.Part&gt;
  UserPartChat: User.User, Exercise.Part -&gt; one Chat &lt;BOT + USER&gt;
  Bot
</code></pre>
<p>We haven’t specified the <em>User</em> concept, since it could take many forms; all that matters for tracking completed exercises is that it provide some identifiers, given by the type <em>User.User</em>, which indexes the <em>Drill</em> concept, so there is one instance of <em>Drill</em> for each user. In our implementation, the browser naturally provides a distinct identifier for each user and no explicit implementation of such a concept is needed. We currently aren’t recording completed exercises, but could easily do that by labeling them with a browser identifier, for example.</p>
<p>There are two instantiations of the <em>Advice</em> concept, one holding advice for each competence and one holding specific advice for each exercise part.</p>
<p>The <em>Chat</em> concept is instantiated in two dimensions, over users and exercise parts, so each user has a separate chat for each exercise part they are working on. The <em>Party</em> parameter of the <em>Chat</em> concept is instantiated with a type consisting of two simple constant values: <em>USER</em> representing the user, and <em>BOT</em> representing the LLM bot. Don’t be confused by the <em>User</em> vs. <em>Party</em> types: the users of the app as a whole are not the parties to the chats, since each chat involves only one user (and the bot).</p>
<h1 id="concept-synchronizations">Concept Synchronizations<a hidden class="anchor" aria-hidden="true" href="#concept-synchronizations">#</a></h1>
<p>Almost all of the actions of the concepts are executed independently but there are a few key synchronizations.</p>
<p>One occurs when the student submits a solution to an exercise part:</p>
<pre><code>sync userSubmitsPart (u: User)	
  when UserDrill[u].submit ()
  let
	  p = UserDrill[u].selectedTask
	  c = Exercise.competence[p]
	  q =
	    ExerciseAdvice[p]
	    ^ CompetenceAdvice[c]
	    ^ Exercise.description[p]
	    ^ UserDrill[u].current[p]
  in
    Bot.ask (q, r)
    UserPartChat[u,p].post (USER, q, qm)
    UserPartChat[u,p].post (BOT, r, rm)
</code></pre>
<p>When a user clicks on the button to submit a solution, the relevant exercise part <em>p</em> is the one that is selected (in the <em>Exercise</em> concept), and it has an associated competence <em>c</em>. The advice texts for the exercise and competence are found in the <em>Advice</em> concept state, and concatenated with the exercise text and the student solution to form the query <em>q</em> to the LLM. The query and the LLM’s response <em>r</em> are then posted in the chat on behalf of the nominal <em>USER</em> party and <em>BOT</em> party.</p>
<p><strong>A technical note</strong>: For brevity, I’ve assumed that the <em>out</em> parameters of actions are declared implicitly. In a more conventional programming style, I might have written</p>
<pre><code>Msg rm = UserPartChat[u,p].post (BOT, r)
</code></pre>
<p>for example. I prefer to treat the out parameters more like other arguments so they can be named (which matters more when an action has more than one of them). Also, I haven’t included the extra prefixes that are added to the chat posts (“You submitted: “, “Feedback: “).</p>
<p>A similar but simpler sync is needed when the user posts a question to the LLM in the chat.</p>
<h1 id="the-design-as-a-diagram">The design as a diagram<a hidden class="anchor" aria-hidden="true" href="#the-design-as-a-diagram">#</a></h1>
<p>The entire concept design can be shown as a diagram. Here it is:</p>
<p><img loading="lazy" src="tutor-diagram.png" alt=""  />
</p>
<p>Each concept is shown as a box with a thick grey outline. Inside each box, there is the concept state (shown as a kind of entity relationship diagram), and arrows representing actions.</p>
<p>Let’s look at the <em>Drill</em> concept, for example. There are two sets represented in the state by the capitalized words &lt;<em>Task</em>&gt; and <em>Text</em>. &lt;<em>Task</em>&gt; is a type parameter (hence the angle brackets); you can see from the dotted line that in the composition it is bound to the <em>Part</em> type of the <em>Exercise</em> concept. <em>Text</em> is a primitive type of text strings. The two relations between &lt;<em>Task</em>&gt; and <em>Text</em> are shown as solid lines, and correspond to the declarations in the textual form of the concept:</p>
<pre><code>  current: Task -&gt; lone Text
  submitted: Task -&gt; lone Text
</code></pre>
<p>The “pin” labeled <em>selected</em> represents the selected task:</p>
<pre><code>	selected: lone Task
</code></pre>
<p>There are three solid arrows representing the three actions of the concept, and their target shows which state component they update. So <em>selectTask</em> sets which task is selected; <em>edit</em> updates the current text for a task; and <em>submit</em> sets the submitted text for a task.</p>
<p>The dashed arrows represent the synchronizations. So the arrow from <em>submit</em> to <em>ask</em> says that when <em>submit</em> happens there is a sync that causes <em>ask</em> to happen to; and the arrow from <em>ask</em> to <em>post</em> means that this third action will happen too.</p>
<p>A few more details about the diagrammatic notation:</p>
<ul>
<li><strong>Relations</strong>. I’m using lines to represent relations, as in entity-relationship diagrams. I realize that programmers who are unfamiliar with ER or UML diagrams find this confusing, but in my view it’s superior to any other way of showing an abstract state and there are no viable alternatives.</li>
<li><strong>No relation arrows</strong>. I’ve departed from traditional ER representations (and notation that I’ve advocated myself and taught to students in the past, such as the diagrammatic notation for Alloy) in a few key respects. There are no arrows on the relations, even though a mathematical relation is directed. I removed the arrows both because the direction is not essential to the design (it’s only needed to ensure that updates and queries are specified consistently), and more importantly, I want the design diagram to emphasize <em>causality</em>, so I’m reserving arrows for causal effects.</li>
<li><strong>Sets as pins</strong>. Another departure from ER is to show dynamic subsets as pins, rather than using a special subset arrow. I like this because it’s easier to draw and allows you to follow paths in the diagram (so <em>selected.current</em>, eg, is the path that gets you the current text of the selected task).</li>
<li><strong>Omissions</strong>. I’ve omitted some details that are present in the textual form that could be included, most notably relation multiplicities. I’ve also omitted some state components (such as the <em>description</em> relation for exercises), and am only showing some synchronizations.</li>
<li><strong>Instantiations</strong>. I’ve only shown one instantiation of <em>Advice</em>, and the indexing of <em>Drill</em> and <em>Chat</em> isn’t shown.</li>
</ul>
<p>I plan to write a tutorial soon explaining the notation in more detail.</p>
<h1 id="state-queries-and-concept-mapping">State Queries and Concept Mapping<a hidden class="anchor" aria-hidden="true" href="#state-queries-and-concept-mapping">#</a></h1>
<p>A simple action involving one concept can still result in a variety of effects in the user interface. Note in particular that when the action</p>
<pre><code>UserDrill[u].selectTask(p)
</code></pre>
<p>is performed, in which a user <em>u</em> selects exercise part <em>p</em> as their current task, the editor buffer will be updated to display</p>
<pre><code>UserDrill[u].current[UserDrill[u].selected]
</code></pre>
<p>which holds the current version of the text for the selected part, and the help window will display</p>
<pre><code>CompetenceAdvice.advices[
	Exercise.competence[UserDrill[u].selected]
	]
</code></pre>
<p>which is the advice text for the competence associated with the current exercise part. These updates occur because the view in the user interface is defined in terms of queries over the concept states. You should think of these queries being executed reactively. Their definition is part of what I call the <em>concept mapping</em> and might be elaborated more or less explicitly along with the wireframe design.</p>
<h1 id="summary-of-concept-design-principles">Summary of Concept Design Principles<a hidden class="anchor" aria-hidden="true" href="#summary-of-concept-design-principles">#</a></h1>
<p>This case study has illustrated the following concept design principles:</p>
<ul>
<li><strong>Modularity</strong>. Because the app has only one page, and its various elements interact with each other, conventional approaches would treat the app as a monolith (eg, in a typical UX approach by specifying wireframes and flows, or in a more formal approach by creating a single data model). Using concepts, we were able to break the app into pieces that can be understood independently, and to describe the interactions as syncs.</li>
<li><strong>Familiarity</strong>. Concept design encourages you to use standard, familiar concepts when possible: we did this with the <em>Chat</em> concept, avoiding specializing it to incorporate submissions and feedback.</li>
<li><strong>Polymorphism</strong>. Concepts should be as generic as possible. Making <em>Advice</em> polymorphic in the <em>Topic</em> type, and not tying it to competences, allowed us to instantiate it also to hold advice about particular exercise parts.</li>
<li><strong>Lifting</strong>. Many concepts can be simplified by removing indexing from the concept’s local state and applying it at the app level, with an indexed collection of concept instances instead. We applied this to the <em>Chat</em> and <em>Drill</em> concepts. In the case of <em>Drill</em>, the opportunity to lift suggested factoring <em>Drill</em> out from <em>Exercise</em>, which also helpfully separates static data (the exercises and their components) from dynamic data (the evolving submissions).</li>
<li><strong>Abstraction</strong>. Details of a concept are excluded if they are not relevant to the essential design questions. For example, <em>Drill.edit</em> embodies all the complexity of a text editor, but for the purpose of high-level design, it’s best just to assume this.</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>

  </footer>
</article>
    </main>
    
<footer class="footer">


    <span>&copy; 2025 <a href="https://essenceofsoftware.com">Daniel Jackson</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
